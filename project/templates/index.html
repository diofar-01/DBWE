{% extends "base.html" %}

{% block content %}
  {% if current_user.is_authenticated %}
    <h1 class="title has-text-centered">Willkommen, {{ current_user.name }}!</h1>
  {% endif %}
  <h2 class="subtitle has-text-centered">Alle Beiträge</h2>

  <div class="columns is-centered">
    <div class="column is-half">
      {% for post in posts %}
        <div class="box mb-4">
          <!-- Beitragstitel -->
          <p class="has-text-weight-bold">{{ post.title }}</p>
          <!-- Datum und Uhrzeit der Veröffentlichung -->
          <p class="is-size-7 has-text-grey">
            Veröffentlicht am: {{ post.date_created.strftime('%d.%m.%Y %H:%M') }}
          </p>
          <!-- Inhalt des Beitrags -->
          <p>{{ post.meinung }}</p>
          
          <!-- Kommentare anzeigen -->
          {% if post.comments %}
            <hr>
            <strong>Kommentare:</strong>
            {% for c in post.comments %}
              <p>
                {{ c.text }} 
                <small>
                  - {{ c.comment_author.name }} 
                  ({{ c.date_created.strftime('%d.%m.%Y %H:%M') }})
                </small>
              </p>
            {% endfor %}
          {% endif %}
          
          <!-- Kommentarformular (nur wenn eingeloggt) -->
          {% if current_user.is_authenticated %}
            <hr>
            <form method="POST" action="{{ url_for('main.index') }}">
              <input type="hidden" name="post_id" value="{{ post.id }}">
              <div class="field">
                <label class="label">Neuen Kommentar hinzufügen</label>
                <div class="control">
                  <textarea class="textarea" name="comment_text" placeholder="Dein Kommentar" required></textarea>
                </div>
              </div>
              <button class="button is-link" type="submit">Kommentieren</button>
            </form>
          {% else %}
            <hr>
            <p class="is-size-7">Bitte <a href="{{ url_for('auth.login') }}">anmelden</a>, um zu kommentieren.</p>
          {% endif %}
        </div>
      {% endfor %}
    </div>
  </div>
{% endblock %}
